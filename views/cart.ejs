<%- include('partials/header') %>
<h1 class="mt-4 mb-4">Shopping Cart</h1>
<div class="container">
  <% if (!cart.items || cart.items.length === 0) { %>
    <p>Your cart is empty.</p>
  <% } else { %>
    <table class="table table-bordered align-middle" id="cart-table">
      <thead>
        <tr>
          <th>Item Description</th>
          <th style="width:180px;">Quantity</th>
          <th>Price</th>
          <th style="width:100px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% cart.items.forEach(function(i) { %>
          <tr class="cart-item" data-id="<%= i.product._id %>">
            <td>
              <%= i.product.name %>
            </td>
            <td>
              <div class="input-group" style="max-width:120px;">
                <button class="btn btn-outline-secondary btn-qty" data-action="decrement" <%= i.quantity <= 1 ? 'disabled' : '' %>>-</button>
                <span class="form-control text-center qty" style="padding:0 0;"><%= i.quantity %></span>
                <button class="btn btn-outline-secondary btn-qty" data-action="increment">+</button>
              </div>
            </td>
            <td>₹<%= i.product.price %></td>
            <td>
              <button class="btn btn-link text-danger btn-remove" title="Remove"><b>&times;</b></button>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
    <div class="text-end" id="cart-total"><strong>
      Total: ₹<span id="total-amount"><%= cart.items.reduce((s,i)=>s + (i.product.price * i.quantity), 0) %></span>
    </strong></div>
  <% } %>
</div>

<!-- load cart client script (uses socket.io and session.js which are loaded in header) -->
<script src="/js/cart.js"></script>

<%- include('partials/footer') %>
